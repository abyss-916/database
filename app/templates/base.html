{% extends "bootstrap/base.html" %}

{% block title %}
{% if title %}{{ title }} - 银行管理系统{% else %}银行管理系统{% endif %}
{% endblock %}

{% block navbar %}
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">切换导航</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="{{ url_for('dashboard.index') }}">银行管理系统</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            {% if current_user.is_authenticated %}
            <ul class="nav navbar-nav">
                <li><a href="{{ url_for('dashboard.index') }}">首页</a></li>
                {% if current_user.user_type == 'employee' %}
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">客户管理 <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="{{ url_for('customers.list') }}">客户列表</a></li>
                        <li><a href="{{ url_for('customers.create') }}">新增客户</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">账户管理 <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="{{ url_for('accounts.list') }}">账户列表</a></li>
                        <li><a href="{{ url_for('accounts.create') }}">创建账户</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">贷款管理 <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="{{ url_for('loans.list') }}">贷款列表</a></li>
                        <li><a href="{{ url_for('loans.apply') }}">发放贷款</a></li>
                    </ul>
                </li>
                {% if current_user.employee.is_manager() %}
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">员工管理 <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="{{ url_for('employees.list') }}">员工列表</a></li>
                        <li><a href="{{ url_for('employees.create') }}">新增员工</a></li>
                    </ul>
                </li>
                {% endif %}
                {% else %}
                <!-- 客户视图 -->
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">我的账户 <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="{{ url_for('accounts.my_accounts') }}">账户列表</a></li>
                        <li><a href="{{ url_for('accounts.transfer') }}">转账</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">我的贷款 <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="{{ url_for('loans.my_loans') }}">贷款列表</a></li>
                        <li><a href="{{ url_for('loans.payment') }}">贷款还款</a></li>
                    </ul>
                </li>
                <li><a href="{{ url_for('transactions.my_transactions') }}">交易记录</a></li>
                {% endif %}
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="#">欢迎, {{ current_user.username }}</a></li>
                <li><a href="{{ url_for('auth.logout') }}">登出</a></li>
            </ul>
            {% else %}
            <ul class="nav navbar-nav navbar-right">
                <li><a href="{{ url_for('auth.login') }}">登录</a></li>
                <li><a href="{{ url_for('auth.register') }}">注册</a></li>
            </ul>
            {% endif %}
        </div>
    </div>
</nav>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert-{{ category }}">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                {{ message }}
            </div>
            {% endfor %}
            {% endif %}
            {% endwith %}
            {% block app_content %}{% endblock %}
        </div>
    </div>
</div>
{% endblock %}
