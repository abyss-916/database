{% extends "base.html" %}

{% block app_content %}
<div class="row">
    <div class="col-md-12">
        <h1>账户列表</h1>
        
        {% if current_user.user_type == 'employee' %}
        <div class="pull-right">
            <a href="{{ url_for('accounts.create') }}" class="btn btn-primary">创建账户</a>
        </div>
        {% endif %}
        
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>账户号码</th>
                    <th>账户类型</th>
                    <th>余额</th>
                    <th>创建日期</th>
                    <th>最后访问</th>
                    <th>关联客户</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                {% for account in accounts %}
                <tr>
                    <td>{{ account.account_number }}</td>
                    <td>
                        {% if account.account_type == 'savings' %}
                            储蓄账户
                            {% if account.savings_account %}
                            <br><small class="text-muted">利率: {{ account.savings_account.interest_rate }}%</small>
                            {% endif %}
                        {% else %}
                            支票账户
                            {% if account.checking_account %}
                            <br><small class="text-muted">透支额度: {{ account.checking_account.overdraft_limit }}</small>
                            {% endif %}
                        {% endif %}
                    </td>
                    <td>¥{{ "%.2f"|format(account.balance) }}</td>
                    <td>{{ account.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                    <td>{{ account.last_access_date.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                    <td>
                        {% for customer in account.customers %}
                            {{ customer.name }}<br>
                        {% endfor %}
                    </td>
                    <td>
                        <a href="{{ url_for('accounts.detail', account_id=account.id) }}" class="btn btn-sm btn-info">详情</a>
                        {% if current_user.user_type == 'employee' or account in current_user.customer.accounts %}
                        <a href="{{ url_for('accounts.deposit', account_id=account.id) }}" class="btn btn-sm btn-success">存款</a>
                        <a href="{{ url_for('accounts.withdraw', account_id=account.id) }}" class="btn btn-sm btn-warning">取款</a>
                        {% endif %}
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="7" class="text-center">暂无账户数据</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
